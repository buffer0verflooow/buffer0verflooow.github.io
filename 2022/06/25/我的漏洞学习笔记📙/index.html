<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"buffer0verflooow.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="前言漏洞的学习要有连续性，多记录，多总结，多回顾。 🌟漏洞学习方法以下要说的漏洞挖掘方法都是从OffensiveCon22 - Mark Dowd- Keynote -How Do You Actually Find Bugs?学的，个人感觉是贴合实际的，也很具有可执行性。 1、心态耐心、毅力、细心、思考、好奇心 要有一个积极的心态，就是当发现代码的逻辑与自己的理解有很大不同时，能接受失败，从头">
<meta property="og:type" content="article">
<meta property="og:title" content="我的漏洞学习笔记📙">
<meta property="og:url" content="https://buffer0verflooow.github.io/2022/06/25/%E6%88%91%E7%9A%84%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%F0%9F%93%99/index.html">
<meta property="og:site_name" content="buffer0verflooow - Blog">
<meta property="og:description" content="前言漏洞的学习要有连续性，多记录，多总结，多回顾。 🌟漏洞学习方法以下要说的漏洞挖掘方法都是从OffensiveCon22 - Mark Dowd- Keynote -How Do You Actually Find Bugs?学的，个人感觉是贴合实际的，也很具有可执行性。 1、心态耐心、毅力、细心、思考、好奇心 要有一个积极的心态，就是当发现代码的逻辑与自己的理解有很大不同时，能接受失败，从头">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-06-25T02:47:19.000Z">
<meta property="article:modified_time" content="2022-07-03T14:32:29.057Z">
<meta property="article:author" content="buffer0verflooow">
<meta property="article:tag" content="note">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://buffer0verflooow.github.io/2022/06/25/%E6%88%91%E7%9A%84%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%F0%9F%93%99/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://buffer0verflooow.github.io/2022/06/25/%E6%88%91%E7%9A%84%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%F0%9F%93%99/","path":"2022/06/25/我的漏洞学习笔记📙/","title":"我的漏洞学习笔记📙"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>我的漏洞学习笔记📙 | buffer0verflooow - Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">buffer0verflooow - Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/home/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%F0%9F%8C%9F%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95"><span class="nav-number">2.</span> <span class="nav-text">🌟漏洞学习方法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81%E5%BF%83%E6%80%81"><span class="nav-number">2.1.</span> <span class="nav-text">1、心态</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%A4%B1%E8%B4%A5%EF%BC%9F"><span class="nav-number">2.1.1.</span> <span class="nav-text">如何处理失败？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E9%81%93%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%AF%A5%E7%BB%93%E6%9D%9F"><span class="nav-number">2.1.2.</span> <span class="nav-text">知道什么时候该结束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A5%E4%B8%81"><span class="nav-number">2.1.3.</span> <span class="nav-text">补丁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%A1%E5%BF%83"><span class="nav-number">2.1.4.</span> <span class="nav-text">信心</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%8F%E8%A7%81%E5%92%8C%E5%81%87%E8%AE%BE"><span class="nav-number">2.1.5.</span> <span class="nav-text">偏见和假设</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E5%AE%A1%E8%AE%A1%E6%B5%81%E7%A8%8B"><span class="nav-number">2.2.</span> <span class="nav-text">2、审计流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BB%E6%89%BE%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-number">2.2.1.</span> <span class="nav-text">寻找什么？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%80%9F%E7%94%A8%E6%83%B3%E6%B3%95"><span class="nav-number">2.2.2.</span> <span class="nav-text">借用想法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%B0%E5%BD%95%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8F%91%E7%8E%B0"><span class="nav-number">2.2.3.</span> <span class="nav-text">记录自己的发现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%BF%E6%B3%9B%E7%9A%84%E5%BA%94%E7%94%A8%E8%87%AA%E5%B7%B1%E7%9A%84%E7%9F%A5%E8%AF%86"><span class="nav-number">2.2.4.</span> <span class="nav-text">广泛的应用自己的知识</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%90%AF%E5%A4%B1%E8%B4%A5%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="nav-number">2.2.5.</span> <span class="nav-text">重启失败的项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81%E5%88%86%E6%9E%90%E5%A4%B1%E8%B4%A5"><span class="nav-number">2.3.</span> <span class="nav-text">3、分析失败</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E3%80%81%E5%80%9F%E5%8A%A9%E5%B7%A5%E5%85%B7"><span class="nav-number">2.4.</span> <span class="nav-text">4、借助工具</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%F0%9F%8C%9F%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1"><span class="nav-number">3.</span> <span class="nav-text">🌟代码审计</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%F0%9F%8C%9F%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0"><span class="nav-number">4.</span> <span class="nav-text">🌟漏洞复现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CVE-2020-0108"><span class="nav-number">4.1.</span> <span class="nav-text">CVE-2020-0108</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CVE-2021-0694"><span class="nav-number">4.2.</span> <span class="nav-text">CVE-2021-0694</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E7%8E%B0%E6%83%85%E5%86%B5"><span class="nav-number">4.2.1.</span> <span class="nav-text">复现情况</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CVE-2019-2225"><span class="nav-number">4.3.</span> <span class="nav-text">CVE-2019-2225</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CVE-2020-0069"><span class="nav-number">4.4.</span> <span class="nav-text">CVE-2020-0069</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%F0%9F%8C%9F%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91"><span class="nav-number">5.</span> <span class="nav-text">🌟工具开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Android%E9%9D%99%E6%80%81%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7"><span class="nav-number">5.1.</span> <span class="nav-text">Android静态漏洞扫描工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%92%A1%E6%83%B3%E6%B3%95"><span class="nav-number">5.2.</span> <span class="nav-text">💡想法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Android%E5%86%85%E6%A0%B8%E7%9F%A5%E8%AF%86"><span class="nav-number">6.</span> <span class="nav-text">Android内核知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81Android%E5%86%85%E6%A0%B8%E7%AE%80%E4%BB%8B"><span class="nav-number">6.1.</span> <span class="nav-text">1、Android内核简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E5%86%85%E6%A0%B8%E5%86%85%E5%AD%98"><span class="nav-number">6.2.</span> <span class="nav-text">2、内核内存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81%E5%86%85%E6%A0%B8%E6%8E%A5%E5%8F%A3"><span class="nav-number">6.3.</span> <span class="nav-text">3、内核接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E3%80%81%E8%AF%86%E5%88%AB%E6%94%BB%E5%87%BB%E9%9D%A2"><span class="nav-number">6.4.</span> <span class="nav-text">4、识别攻击面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5%E3%80%81%E5%86%85%E6%A0%B8%E7%BC%93%E8%A7%A3%E6%9C%BA%E5%88%B6"><span class="nav-number">6.5.</span> <span class="nav-text">5、内核缓解机制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Android%E5%BA%94%E7%94%A8%E6%B2%99%E7%9B%92%E6%9C%BA%E5%88%B6"><span class="nav-number">7.</span> <span class="nav-text">Android应用沙盒机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81DAC%E6%B2%99%E7%9B%92"><span class="nav-number">7.1.</span> <span class="nav-text">1、DAC沙盒</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90"><span class="nav-number">7.2.</span> <span class="nav-text">2、应用权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81%E5%BA%94%E7%94%A8%E4%BF%A1%E6%81%AF%E7%9A%84%E5%AD%98%E5%82%A8"><span class="nav-number">7.3.</span> <span class="nav-text">3、应用信息的存储</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E3%80%81%E5%BA%94%E7%94%A8%E6%9D%83%E9%99%90%E7%9A%84%E6%98%A0%E5%B0%84"><span class="nav-number">7.4.</span> <span class="nav-text">4、应用权限的映射</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5%E3%80%81%E5%BA%94%E7%94%A8%E7%9A%84SELinux%E6%A0%87%E7%AD%BE"><span class="nav-number">7.5.</span> <span class="nav-text">5、应用的SELinux标签</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6%E3%80%81MAC%E6%B2%99%E7%9B%92"><span class="nav-number">7.6.</span> <span class="nav-text">6、MAC沙盒</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">buffer0verflooow</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://buffer0verflooow.github.io/2022/06/25/%E6%88%91%E7%9A%84%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%F0%9F%93%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="buffer0verflooow">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="buffer0verflooow - Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="我的漏洞学习笔记📙 | buffer0verflooow - Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          我的漏洞学习笔记📙
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-06-25 10:47:19" itemprop="dateCreated datePublished" datetime="2022-06-25T10:47:19+08:00">2022-06-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-07-03 22:32:29" itemprop="dateModified" datetime="2022-07-03T22:32:29+08:00">2022-07-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>漏洞的学习要有连续性，多记录，多总结，多回顾。</p>
<h1 id="🌟漏洞学习方法"><a href="#🌟漏洞学习方法" class="headerlink" title="🌟漏洞学习方法"></a>🌟漏洞学习方法</h1><p>以下要说的漏洞挖掘方法都是从<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=7Ysy6iA2sqA">OffensiveCon22 - Mark Dowd- Keynote -How Do You Actually Find Bugs?</a>学的，个人感觉是贴合实际的，也很具有可执行性。</p>
<h2 id="1、心态"><a href="#1、心态" class="headerlink" title="1、心态"></a>1、心态</h2><p><strong>耐心、毅力、细心、思考、好奇心</strong></p>
<p>要有一个积极的心态，就是当发现代码的逻辑与自己的理解有很大不同时，能接受失败，从头再来。</p>
<p>漏洞挖掘就是一个不断失败的过程。</p>
<h3 id="如何处理失败？"><a href="#如何处理失败？" class="headerlink" title="如何处理失败？"></a>如何处理失败？</h3><ol>
<li>两个项目同时进行，这两个项目可以是相同代码的不同组件，当一个项目到达瓶颈时，搁置一段时间，进行另一个项目；</li>
<li>第二个项目最好是开发项目，开发容易获得成就感。</li>
</ol>
<h3 id="知道什么时候该结束"><a href="#知道什么时候该结束" class="headerlink" title="知道什么时候该结束"></a>知道什么时候该结束</h3><ol>
<li>当切换了几次，还是无法突破瓶颈时；<ol>
<li>一直持续到针对一个问题，会很容易打击积极性和信息。</li>
</ol>
</li>
<li>不要在意沉没成本，可以当作只是暂时搁置，时机合适时再来，这需要对已做的工作做好记录，防止下次进入时又从头再来；</li>
<li>而且，过段时间再来，代码可能就由于更新引入了新的问题。</li>
</ol>
<p>不要想着一口吃个胖子，思考很重要，只有主动思考代码的实现思想，才能减少审计时间，就是主动去猜去想。</p>
<h3 id="补丁"><a href="#补丁" class="headerlink" title="补丁"></a>补丁</h3><ol>
<li>审计时发现补丁说明思考的路径是正确的，还有助于理解问题与解决问题。</li>
</ol>
<h3 id="信心"><a href="#信心" class="headerlink" title="信心"></a>信心</h3><p>初次踏入安全研究会很容易不自信，应该从小处做起，逐渐扩大，以增加信心。</p>
<h3 id="偏见和假设"><a href="#偏见和假设" class="headerlink" title="偏见和假设"></a>偏见和假设</h3><p>这些思想不要有：</p>
<ol>
<li>有很多人审计过这一块了；<ol>
<li>其实可能并没有。</li>
</ol>
</li>
<li>即使我能发现问题，也是不可利用的；<ol>
<li>缓解措施或许可以绕过。</li>
</ol>
</li>
<li>XXX攻击面现在已经过时了；</li>
<li>这儿没什么bugl；<ol>
<li>变体或代码重新引入bug。</li>
</ol>
</li>
<li>协议不允许做XXX动作。</li>
<li>不要一开始就阅读文档手册，会影响想象力，当审计遇到模棱两可的时候，在看手册。</li>
</ol>
<h2 id="2、审计流程"><a href="#2、审计流程" class="headerlink" title="2、审计流程"></a>2、审计流程</h2><ol>
<li>试图理解代码，理解代码以后，才能更好地写出漏洞利用；<ol>
<li>一般都想要缩短这个过程，借助工具、fuzz、静态分析等，这些有用，但是很依赖于工具本身。</li>
</ol>
</li>
<li>理解一件事最好的方式是向他人讲解这个东西；<ol>
<li>写文章或是找个人分享。</li>
</ol>
</li>
</ol>
<h3 id="寻找什么？"><a href="#寻找什么？" class="headerlink" title="寻找什么？"></a>寻找什么？</h3><p>软件风险点 &#x3D; 供给面X复杂度（漏挖之友）</p>
<p>攻击面可以是间接的，隐藏或不明显的攻击面是最好的，供应商自定义的那些。</p>
<p>复杂度：</p>
<ol>
<li>新的功能；</li>
<li>对旧东西的兼容；</li>
<li>为了开发简单，使用现有库等，引入自己不需要的东西，如<code>log4j</code>。</li>
</ol>
<h3 id="借用想法"><a href="#借用想法" class="headerlink" title="借用想法"></a>借用想法</h3><ol>
<li>bugtracker&#x2F;diff，关注经常写bug的那个人的提交；</li>
<li>看看公开漏洞，借鉴思路，复现思路，自动化。</li>
</ol>
<h3 id="记录自己的发现"><a href="#记录自己的发现" class="headerlink" title="记录自己的发现"></a>记录自己的发现</h3><p>想法、bug条件、数据结构、算法等等都可以，记录失败的想法及原因，避免再犯这个错误。</p>
<h3 id="广泛的应用自己的知识"><a href="#广泛的应用自己的知识" class="headerlink" title="广泛的应用自己的知识"></a>广泛的应用自己的知识</h3><p>审计复杂的组件时，去看看其他人如何实现它的，还有，当难以理解组件时，可以查看不同的代码库，说不定能理解。</p>
<h3 id="重启失败的项目"><a href="#重启失败的项目" class="headerlink" title="重启失败的项目"></a>重启失败的项目</h3><p>重启之前失败的审计或bug，代码会被重写，会添加新特性，执行环境也会变，查看当时不可行的bug，现在是否依然不可行。</p>
<h2 id="3、分析失败"><a href="#3、分析失败" class="headerlink" title="3、分析失败"></a>3、分析失败</h2><ol>
<li>同一块代码为什么别人成功而你没有？</li>
<li>试着找出：我忽视了什么？</li>
<li>这是一个有用的技巧或是自己盲点吗？</li>
<li>通过这个能有所提高吗？</li>
<li>这个错误是一种模式吗？</li>
</ol>
<h2 id="4、借助工具"><a href="#4、借助工具" class="headerlink" title="4、借助工具"></a>4、借助工具</h2><p>工具、fuzz、静态分析等可以节省大量时间，但别迷失在工具中，开发一个fuzz不要急于求成，可以让其慢慢成长，工具与代码审计之间要找到平衡。</p>
<h1 id="🌟代码审计"><a href="#🌟代码审计" class="headerlink" title="🌟代码审计"></a>🌟代码审计</h1><h1 id="🌟漏洞复现"><a href="#🌟漏洞复现" class="headerlink" title="🌟漏洞复现"></a>🌟漏洞复现</h1><h2 id="CVE-2020-0108"><a href="#CVE-2020-0108" class="headerlink" title="CVE-2020-0108"></a>CVE-2020-0108</h2><p>要想实现自动化，这个漏洞需要：</p>
<ol>
<li>构造输入，触发异常；</li>
<li>在应用程序端接受异常；</li>
<li>判断是否可利用。</li>
</ol>
<h2 id="CVE-2021-0694"><a href="#CVE-2021-0694" class="headerlink" title="CVE-2021-0694"></a>CVE-2021-0694</h2><p>下面是已知的一些信息：</p>
<p><code>BG-FGS-start while-in-use</code>权限限制的改进。</p>
<p>从后台启动的前台服务不应具有<code>while-in-use</code>的访问权限，如定位&#x2F;摄像&#x2F;麦克风。</p>
<p>以前我们只在服务启动时通过<code>startService()</code>或<code>bindService()</code>命令设置<code>mAllowWhileInUsePermissionInFgs</code>。但是在 服务启动后，<code>Service.startForeground()</code>的调用可能会在一段时间后进行。而那个时候，调用者可能已经不在前台了。<br>这个 CL将在此基础上增加进一步的限制：</p>
<ol>
<li>如果第一次调用<code>Service.startForeground()</code>超过10秒（可由<code>DeviceConfig</code>键 <code>fgs_start_foreground_timeout </code>配置）。<code>Context.startService()</code>调用后，检查服务的应用程序状态并设置 <code>mAllowWhileInUsePermissionInFgs</code>。</li>
<li>在<code>Service.stopForeground()</code>调用时，<code>mAllowWhileInUsePermissionInFgs</code> 应该被重置为false，这样<code>FGS</code>的<code>while-in-use</code>的权限就不被允许了。</li>
<li>在<code>Context.startForegroundService()</code>(或<code>Context.startService())</code>之后<code>-&gt; Service.startForeground() -&gt; Service.stopForeground()</code>，第二次或更多次 调用<code>Service.startForeground()</code>，检查该服务的 <code>app proc</code>状态，并再次设置<code>mAllowWhileInUsePermissionInFgs</code>。</li>
</ol>
<h3 id="复现情况"><a href="#复现情况" class="headerlink" title="复现情况"></a>复现情况</h3><p>可以看出问题应该与<code>mAllowWhileInUsePermissionInFgs</code>有关，但是奈何对<code>service</code>的启动还有框架源码的理解不够，写不出来<code>poc</code>。暂时先搁置一下，再看看有没有类似的漏洞，找找思路，或者是再积累一些知识。</p>
<p>又试了一下，还是不对，可能需要看看源码了。</p>
<p><code>poc</code>写了，也跑了一下，当程序不在前台时获取录音，也成功了，但是不好证伪，因为，官方的Android11镜像应该都是没有修复的，而漏洞又只影响Android11，所以不好去测试补丁后的情况。</p>
<h2 id="CVE-2019-2225"><a href="#CVE-2019-2225" class="headerlink" title="CVE-2019-2225"></a>CVE-2019-2225</h2><p>配置错误导致的严重漏洞，也很有意思，关键是可以通过应用程序直接进行攻击</p>
<h2 id="CVE-2020-0069"><a href="#CVE-2020-0069" class="headerlink" title="CVE-2020-0069"></a>CVE-2020-0069</h2><p>驱动漏洞：</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/217231">https://www.anquanke.com/post/id/217231</a></p>
<p><a target="_blank" rel="noopener" href="https://forum.xda-developers.com/t/amazing-temp-root-for-mediatek-armv8-2020-08-24.3922213/">https://forum.xda-developers.com/t/amazing-temp-root-for-mediatek-armv8-2020-08-24.3922213/</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.quarkslab.com/cve-2020-0069-autopsy-of-the-most-stable-mediatek-rootkit.html">https://blog.quarkslab.com/cve-2020-0069-autopsy-of-the-most-stable-mediatek-rootkit.html</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/quarkslab/CVE-2020-0069_poc">https://github.com/quarkslab/CVE-2020-0069_poc</a></p>
<h1 id="🌟工具开发"><a href="#🌟工具开发" class="headerlink" title="🌟工具开发"></a>🌟工具开发</h1><h2 id="Android静态漏洞扫描工具"><a href="#Android静态漏洞扫描工具" class="headerlink" title="Android静态漏洞扫描工具"></a>Android静态漏洞扫描工具</h2><p>以soot为基础进行的，现在也只进行到能获取一些AndroidManifest数据，没有进行到下一步的原因是：一是想做界面，但是和Java后端又不会，成本很高；二是，还没有想好要怎么继续分析，或者说功能要怎么开发。</p>
<h2 id="💡想法"><a href="#💡想法" class="headerlink" title="💡想法"></a>💡想法</h2><p>虽然<code>PendingIntent</code>增加了<code>PendingIntent.FLAG_IMMUTABLE</code>标志，但是，可以想办法监听系统中发送的<code>PendingIntent</code>，看哪个倒霉催的程序员不适用这个标志，或许这种漏洞真是绝了，也说不定。</p>
<h1 id="Android内核知识"><a href="#Android内核知识" class="headerlink" title="Android内核知识"></a>Android内核知识</h1><h2 id="1、Android内核简介"><a href="#1、Android内核简介" class="headerlink" title="1、Android内核简介"></a>1、Android内核简介</h2><ul>
<li><code>EL0</code>层：普通<code>Application</code>、<code>TA (Trusted Application)</code>；</li>
<li><code>EL1</code>层：<code>Linux</code>内核 (<code>Guest OS</code>)、<code>TEE</code>内核 (<code>Trusted OS</code>)；</li>
<li><code>EL2</code>层：<code>Hypervisor (No Hypervisor in Secure World)</code>；</li>
<li><code>EL3</code>层：<code>Secure Monitor</code>；</li>
<li>不同的<code>EL</code>对应不同的权限，不同的寄存器，高权限的行为在低<code>EL</code>上是不能执行的；</li>
<li>常见安全问题：低权限攻击高权限、非安全侧攻击安全侧。</li>
</ul>
<h2 id="2、内核内存"><a href="#2、内核内存" class="headerlink" title="2、内核内存"></a>2、内核内存</h2><ul>
<li>单个进程角度：低地址为<code>user</code>内存，高地址（<code>TASK_SIZE</code>以上）为<code>kernel</code>内存；</li>
<li>系统角度：内核地址是共享的，各个进程地址隔离。</li>
</ul>
<h2 id="3、内核接口"><a href="#3、内核接口" class="headerlink" title="3、内核接口"></a>3、内核接口</h2><ul>
<li><code>EL0</code>调用<code>EL1</code>方法：通过中断指令，内核进入中断向量表，再通过系统调用号进入各类系统调用；</li>
<li><code>ARM</code>中的指令：<code>svc</code>；</li>
<li><code>libc.so</code>里面所有系统调用都会用到<code>DO_CALL</code>这个宏，包括但不限于：<code>open</code>, <code>read</code>, <code>write</code>, <code>fork</code>,<code> ioctl</code>等；</li>
<li>虚拟文件系统（<code>VFS</code>）：所有的驱动程序都是通过文件进行调用的。</li>
</ul>
<h2 id="4、识别攻击面"><a href="#4、识别攻击面" class="headerlink" title="4、识别攻击面"></a>4、识别攻击面</h2><ul>
<li>入口：<code>/dev</code>、<code>/proc</code>等驱动，系统调用；</li>
<li>内存操作函数：<code>put_user</code>, <code>get_user</code>, <code>copy_to_user</code>, <code>clear_user</code>, <code>copy_from_user</code>, <code>strncpy_from_user</code>；</li>
<li>驱动：经常用到的比如字符设备驱动、网络设备驱动以及<code>NetLink</code>等<ul>
<li>重要结构体：<code>file_operations</code>；</li>
<li><code>read/write</code>函数：内核<code>VFS</code>框架里，<code>count</code>是被校验过的；</li>
<li><code>ioctl</code>：<code>arg</code>是一个指针，没有标准的类型，<code>VFS</code>框架无法校验，如何使用全部取决于开发人员；</li>
<li><code>mmap</code>：内核驱动需实现<code>xxxx_mmap</code>，最终调用到<code>remap_pfn_range</code>。</li>
</ul>
</li>
</ul>
<h2 id="5、内核缓解机制"><a href="#5、内核缓解机制" class="headerlink" title="5、内核缓解机制"></a>5、内核缓解机制</h2><ul>
<li><code>KASLR</code>：内核地址随机化；</li>
<li><code>NX</code>：数据区不可执行；</li>
<li>栈<code>Cookie</code>：返回地址之前的随机数，覆盖返回地址之前会先覆盖<code>Cookie</code>；</li>
<li><code>SELinux</code>：基于策略的保护方式；</li>
<li><code>PXN</code>：内核态不能执行用户态地址的代码；</li>
<li><code>PAN</code>：内核态不能访问用户态地址数据；</li>
<li><code>CFI</code>：控制流完整性，只有特定流才能调用。</li>
</ul>
<h1 id="Android应用沙盒机制"><a href="#Android应用沙盒机制" class="headerlink" title="Android应用沙盒机制"></a>Android应用沙盒机制</h1><h2 id="1、DAC沙盒"><a href="#1、DAC沙盒" class="headerlink" title="1、DAC沙盒"></a>1、DAC沙盒</h2><ul>
<li><code>Android</code>上的<code>App</code>并不像<code>Linux</code>上的用户程序那样，启动应用的<code>uid</code>默认就是登录用户的<code>uid</code>，除非你使用<code>sudo</code>或者<code>setuid</code>等机制。而是每个<code>Android</code>应用都对应了一个<code>uid</code>，也就是一个用户，通过<code>Linux</code>系统的<code>DAC</code>机制将应用的数据严格隔离开来。</li>
<li><code>Android</code>并没有使用<code>/etc/passwd</code>配置文件以及<code>useradd</code>、<code>usermod</code>和<code>userdel</code>等二进制来管理用户。实际上<code>Android</code>应用到<code>uid</code>的映射是由<code>PackageManagerService</code>完成的，也就是<code>PMS</code>，并且存储在<code>/data/system/packages.xml</code>中。</li>
<li>将<code>Android</code>应用使用<code>DAC</code>隔离开之后，如果应用要访问任何系统资源，便会被拒绝，所以<code>Android</code>设计了应用权限机制来向应用提供访问系统资源的通道，同时保护系统资源不被滥用。</li>
</ul>
<h2 id="2、应用权限"><a href="#2、应用权限" class="headerlink" title="2、应用权限"></a>2、应用权限</h2><ul>
<li><code>Android</code>应用权限的核心类型分为四种：普通权限、危险权限、签名权限、签名或系统权限。</li>
</ul>
<table>
<thead>
<tr>
<th>权限类型</th>
<th>权限行为</th>
</tr>
</thead>
<tbody><tr>
<td>普通权限(<code>Normal</code>)</td>
<td>普通权限是只需要在<code>AndroidManifest.xml</code>中声明后就可以使用的权限</td>
</tr>
<tr>
<td>危险权限(<code>dangerous</code>)</td>
<td>危险权限除了需要在<code>AndroidManifest.xml</code>中声明之外，在<code>Android 6.0</code>或更高版本还需要使用动态权限API进行申请，并且用户点击同意之后才能使用；在<code>Android 5.1</code>以及更早版本，会在安装时单独列出危险权限以特别提醒用户。<strong>注意，如果自定义权限设置为了危险权限，无论<code>Android</code>版本是多少都只是会在安装时单独列出危险权限。</strong></td>
</tr>
<tr>
<td>签名权限(<code>signature</code>)</td>
<td>签名权限仅会授予给与定义这个权限的包相同签名的应用。</td>
</tr>
<tr>
<td>签名或系统权限(<code>signatureOrSystem</code>)</td>
<td>&#96;signature</td>
</tr>
</tbody></table>
<ul>
<li>在自定义权限中，经常使用<code>signature</code>权限来保护敏感的接口，使其只能被可信的应用调用——那些具备和定义权限者相同签名的应用，如果使用的是<code>signatureOrSystem</code>，这个权限还可以被授予给特权应用。</li>
</ul>
<h2 id="3、应用信息的存储"><a href="#3、应用信息的存储" class="headerlink" title="3、应用信息的存储"></a>3、应用信息的存储</h2><ul>
<li>应用信息的存储位于<code>/data/system/packages.xml</code>中，这里面存储了应用的各种信息，下面是一个示例：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.android.storagemanager&quot;</span> <span class="attr">codePath</span>=<span class="string">&quot;/system/priv-app/StorageManager&quot;</span> <span class="attr">nativeLibraryPath</span>=<span class="string">&quot;/system/priv-app/StorageManager/lib&quot;</span> <span class="attr">publicFlags</span>=<span class="string">&quot;541605445&quot;</span> <span class="attr">privateFlags</span>=<span class="string">&quot;8&quot;</span> <span class="attr">ft</span>=<span class="string">&quot;165151eba60&quot;</span> <span class="attr">it</span>=<span class="string">&quot;165151eba60&quot;</span> <span class="attr">ut</span>=<span class="string">&quot;165151eba60&quot;</span> <span class="attr">version</span>=<span class="string">&quot;29&quot;</span> <span class="attr">userId</span>=<span class="string">&quot;10036&quot;</span> <span class="attr">appUseNotchMode</span>=<span class="string">&quot;0&quot;</span> <span class="attr">appUseSideMode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">hwExtraFlags</span>=<span class="string">&quot;0&quot;</span> <span class="attr">isOrphaned</span>=<span class="string">&quot;true&quot;</span> <span class="attr">forceDarkMode</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sigs</span> <span class="attr">count</span>=<span class="string">&quot;1&quot;</span> <span class="attr">schemeVersion</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cert</span> <span class="attr">index</span>=<span class="string">&quot;13&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sigs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">perms</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.USE_RESERVED_DISK&quot;</span> <span class="attr">granted</span>=<span class="string">&quot;true&quot;</span> <span class="attr">flags</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">perms</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">proper-signing-keyset</span> <span class="attr">identifier</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.android.settings&quot;</span> <span class="attr">codePath</span>=<span class="string">&quot;/system/priv-app/Settings&quot;</span> <span class="attr">nativeLibraryPath</span>=<span class="string">&quot;/system/priv-app/Settings/lib&quot;</span> <span class="attr">publicFlags</span>=<span class="string">&quot;675823173&quot;</span> <span class="attr">privateFlags</span>=<span class="string">&quot;8&quot;</span> <span class="attr">ft</span>=<span class="string">&quot;165151eba60&quot;</span> <span class="attr">it</span>=<span class="string">&quot;165151eba60&quot;</span> <span class="attr">ut</span>=<span class="string">&quot;165151eba60&quot;</span> <span class="attr">version</span>=<span class="string">&quot;10010400&quot;</span> <span class="attr">sharedUserId</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">appUseNotchMode</span>=<span class="string">&quot;0&quot;</span> <span class="attr">appUseSideMode</span>=<span class="string">&quot;1&quot;</span> <span class="attr">hwExtraFlags</span>=<span class="string">&quot;0&quot;</span> <span class="attr">isOrphaned</span>=<span class="string">&quot;true&quot;</span> <span class="attr">forceDarkMode</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sigs</span> <span class="attr">count</span>=<span class="string">&quot;1&quot;</span> <span class="attr">schemeVersion</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cert</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sigs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">perms</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.REAL_GET_TASKS&quot;</span> <span class="attr">granted</span>=<span class="string">&quot;true&quot;</span> <span class="attr">flags</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">perms</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">proper-signing-keyset</span> <span class="attr">identifier</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到这个文件中存储有很多内容，最关键的信息包括应用的<code>uid</code>、包名、各类路径，以及定义和授予的权限。</p>
<h2 id="4、应用权限的映射"><a href="#4、应用权限的映射" class="headerlink" title="4、应用权限的映射"></a>4、应用权限的映射</h2><p><code>Android</code>使用的是<code>Linux</code>内核，而在<code>Linux</code>的安全模型中，如果需要访问系统资源，访问系统资源的用户和进程必须具备相应的权限。如何将自行定义的<code>Android</code>权限映射到<code>Linux</code>层面的权限呢？答案就位于<code>/etc/permissions/platform.xml</code>中，下面是该文件的节选：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">permission</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.BLUETOOTH_ADMIN&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">gid</span>=<span class="string">&quot;net_bt_admin&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">permission</span> <span class="attr">name</span>=<span class="string">&quot;android.permission.BLUETOOTH&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">group</span> <span class="attr">gid</span>=<span class="string">&quot;net_bt&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>Android</code>的两个蓝牙权限，分别对应了<code>net_bt_admin</code>和<code>net_bt</code>两个<code>Linux</code>组，在应用被授予相应的权限时，<code>PMS</code>会自动将应用<code>uid</code>加入这两个组中，这样应用就拥有了相应系统资源的访问权限了。</p>
<h2 id="5、应用的SELinux标签"><a href="#5、应用的SELinux标签" class="headerlink" title="5、应用的SELinux标签"></a>5、应用的SELinux标签</h2><p>在<code>Android</code>引入<code>SELinux</code>之后，对应用权限的划分更为细致，<code>Android</code>默认将应用分为四种：不可信应用、特权应用、平台应用和系统应用。</p>
<table>
<thead>
<tr>
<th>SELinux标签</th>
<th>标签行为</th>
</tr>
</thead>
<tbody><tr>
<td>app_domain</td>
<td>所有应用的<code>SELinux</code>标签都继承于此</td>
</tr>
<tr>
<td>isolated_app</td>
<td>在Manifest中配置了<code>isolatedProcess=true</code>的服务进程，几乎没有特权，最典型的例子是<code>WebView</code>和浏览器的渲染进程</td>
</tr>
<tr>
<td>ephemeral_app</td>
<td>所有用户使用的免安装应用都属于此标签，权限低于一般的第三方应用</td>
</tr>
<tr>
<td>untrusted_app_all</td>
<td>所有用户安装的应用都属于此标签，还包括一部分预装应用</td>
</tr>
<tr>
<td>untrusted_app_29</td>
<td><code>targetSdkVersion = 29</code>的不可信应用</td>
</tr>
<tr>
<td>untrusted_app_27</td>
<td><code>25 &lt; targetSdkVersion &lt;= 28</code>的不可信应用</td>
</tr>
<tr>
<td>untrusted_app_25</td>
<td><code>targetSdkVersion &lt;= 25</code>的不可信应用</td>
</tr>
<tr>
<td>priv_app</td>
<td>带有<code>Privileged</code>标记的预装应用，一般安装在<code>/system/priv-app</code>中，不可卸载，但不以<code>system uid</code>运行</td>
</tr>
<tr>
<td>platform_app</td>
<td>具备平台签名，但不以<code>system uid</code>运行的应用。除了AOSP和部分第三方ROM之外，几乎所有的OEM都不会公开其平台私钥，所以一般情况下平台应用只能是OEM提供的</td>
</tr>
<tr>
<td>system_app</td>
<td>既具备平台签名，又以<code>system uid</code>运行(配置<code>android:sharedUserId=”android.uid.system”</code>)的应用。使用<code>system uid</code>运行意味着它们实际不受应用沙盒的限制，并能访问绝大部分<code>Android</code>框架中的系统资源</td>
</tr>
</tbody></table>
<p>具体的配置路径为：<code>aosp/system/sepolicy/</code>，也可以看<code>git</code>上的信息：<a target="_blank" rel="noopener" href="https://android.googlesource.com/platform/external/sepolicy/%E3%80%82">https://android.googlesource.com/platform/external/sepolicy/。</a></p>
<h2 id="6、MAC沙盒"><a href="#6、MAC沙盒" class="headerlink" title="6、MAC沙盒"></a>6、MAC沙盒</h2><p>上面所说的<code>SELinux</code>标签，<code>Android</code>在源代码中为它们定义了不同的<code>SELinux</code>政策，这便实现了<code>MAC</code>层面的沙盒增强。这些政策的路径如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">system/sepolicy/public/app.te</span><br><span class="line">system/sepolicy/private/app.te</span><br><span class="line">system/sepolicy/private/isolated_app.te</span><br><span class="line">system/sepolicy/private/ephemeral_app.te</span><br><span class="line">system/sepolicy/private/untrusted_app_all.te</span><br><span class="line">system/sepolicy/private/untrusted_app_29.te</span><br><span class="line">system/sepolicy/private/untrusted_app_27.te</span><br><span class="line">system/sepolicy/private/untrusted_app_25.te</span><br><span class="line">system/sepolicy/private/priv_app.te</span><br><span class="line">system/sepolicy/private/platform_app.te</span><br><span class="line">system/sepolicy/private/system_app.te</span><br></pre></td></tr></table></figure>

<p>一般来说不建议<code>App</code>层面直接访问具备独立标签的用户态进程或者内核驱动，因为<code>App</code>的<code>SELinux</code>标签划分并非像<code>UID</code>一样细致，如果这样做会导致授予某一个应用权限的时候必须授予应用所在的整个标签权限，违反权限最小化原则。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/note/" rel="tag"># note</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/06/25/Android-Foreground-%E9%A9%BB%E7%95%99%E6%BC%8F%E6%B4%9E-CVE-2020-0108/" rel="prev" title="Android Foreground 驻留漏洞(CVE-2020-0108)">
                  <i class="fa fa-angle-left"></i> Android Foreground 驻留漏洞(CVE-2020-0108)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/07/01/macOS-Intel%E5%9B%BE%E5%BD%A2%E5%86%85%E6%A0%B8%E6%8B%93%E5%B1%95RCE-EOP/" rel="next" title="macOS Intel图形内核拓展RCE+EOP">
                  macOS Intel图形内核拓展RCE+EOP <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">buffer0verflooow</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
